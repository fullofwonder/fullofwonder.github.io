var kInteractive={preRender:function(e,t){var n,a=(t=t||{}).singleElem,i=e||document;a?(n=[e],i=document):n=i.getElementsByClassName("kInteractive"),"undefined"!=typeof isKotobee&&(kInteractive.absoluteURL=t.chapterUrl?t.chapterUrl:angular.element(document.body).scope().data.book.chapter.absoluteURL);for(var r=n.length;r--;){var o=n[r];this.hasClass(o,"gallery")&&kInteractive.gallery.preRender(o,i,r),this.hasClass(o,"questions")&&kInteractive.questions.preRender(o,i,r),!this.hasClass(o,"image")&&"img"!=o.nodeName.toLowerCase()||kInteractive.image.preRender(o,i,r),this.hasClass(o,"link")&&kInteractive.link.preRender(o,i,r),this.hasClass(o,"container")&&kInteractive.container.preRender(o,i,r)}},postRender:function(t,e){var n=(e=e||{}).singleElem;"undefined"!=typeof isKotobee&&(kInteractive.absoluteURL=e.chapterUrl?e.chapterUrl:angular.element(document.body).scope().data.book.chapter.absoluteURL),kInteractive.videoIsFullscreen=!1,kInteractive.timestamp=new Date,kInteractive.currentVideo=kInteractive.currentAudio=null,kInteractive.clearAudioVideo(t);var a,i=t||document;n?(a=[t],i=document):a=i.getElementsByClassName("kInteractive");for(var r=a.length;r--;){var o=a[r];this.hasClass(o,"container")?kInteractive.container.postRender(i,o,r,e):this.hasClass(o,"questions")?kInteractive.questions.postRender(i,o,r,e):this.hasClass(o,"widget")?kInteractive.widget.postRender(i,o,r,e):this.hasClass(o,"video")?kInteractive.video.postRender(i,o,r):this.hasClass(o,"audio")?kInteractive.audio.postRender(i,o,r):this.hasClass(o,"threed")?kInteractive.threed.postRender(i,o,r,e):this.hasClass(o,"gallery")?kInteractive.gallery.postRender(i,o,r):this.hasClass(o,"image")&&kInteractive.image.postRender(i,o,r)}this.firstRun&&(window.addEventListener("resize",function(e){kInteractive.resizeEvent(t,n)}),this.firstRun=!1),kInteractive.resizeEvent(t,n)},actionEvent:function(e){kInteractive.action(e.target)},action:function(e,t){if("undefined"==typeof editorMode||!editorMode){"undefined"!=typeof isKotobee&&(kInteractive.absoluteURL=angular.element(document.body).scope().data.book.chapter.absoluteURL);for(var n=e;!this.hasClass(n,"kInteractive");){if(!n.parentNode)return;if((n=n.parentNode)==document.body)return}this.hasClass(n,"questions")?kInteractive.questions.action(n,e):this.hasClass(n,"widget")?kInteractive.widget.action(n):this.hasClass(e,"link")?kInteractive.link.action(n,e):this.hasClass(e,"image")?kInteractive.image.action(n,e):this.hasClass(n,"gallery")?kInteractive.gallery.action(n,e):this.hasClass(n,"audio")?kInteractive.audio.action(n,e):this.hasClass(n,"video")?kInteractive.video.action(n,e):this.hasClass(n,"threed")&&kInteractive.threed.action(n,e)}},trigger:function(e,t){this.action(t,e)},resizeEvent:function(e,t){var n=e||document;t&&(n=document);for(var a=n.getElementsByClassName("kInteractive"),i=a.length;i--;){var r=a[i];this.hasClass(r,"image")?kInteractive.image.resize(r):this.hasClass(r,"gallery")?kInteractive.gallery.resize(r):this.hasClass(r,"container")?kInteractive.container.resize(r):this.hasClass(r,"video")?kInteractive.video.resize(r):this.hasClass(r,"widget")&&kInteractive.widget.resize(r)}},vQueue:[],youTubeReady:!1,firstRun:!0};if("undefined"==typeof isKotobee){kotobee={};var kotobeeListeners=[];function getKotobeeListener(e){if(e)for(var t=kotobeeListeners.length;t--;)if(kotobeeListeners[t].event==e)return kotobeeListeners[t]}function clearKotobeeListeners(e){for(var t=kotobeeListeners.length;t--;)e&&kotobeeListeners[t].event!=e||kotobeeListeners.splice(t,1)}function dispatchKotobeeEvent(){}function kInteractionStart(){this.log=function(e){},kInteractive.setDOMParser(),kInteractive.preRender(),kInteractive.postRender()}function kInteractionStartSingleElem(e){kInteractive.setDOMParser(),kInteractive.preRender(e,{singleElem:!0}),kInteractive.postRender(e,{singleElem:!0})}document.addEventListener("DOMContentLoaded",function(e){"undefined"!=typeof kotobeeReady&&kotobeeReady(e),document.dispatchEvent(new Event("kotobeeReady")),document.dispatchEvent(new Event("kotobeeChapterLoaded")),kotobee.dispatchEvent("ready"),kotobee.dispatchEvent("chapterLoaded"),document.addEventListener("scroll",function(e){kotobee.dispatchEvent("scrolled",e)})}),kotobee.addEventListener=function(){if(!(arguments.length<2)){var e,t=arguments[0],n={};e=2==arguments.length?arguments[1]:(n=arguments[1],arguments[2]),n.unique&&clearKotobeeListeners(t);var a={event:t,cb:e};kotobeeListeners.push(a)}},kotobee.dispatchEvent=function(e,t){if(e){var n=getKotobeeListener(e);n&&n.cb&&n.cb.apply(this,[t])}};try{document.addEventListener("DOMContentLoaded",kInteractionStart,!1)}catch(e){window.addEventListener("load",kInteractionStart,!1)}}kInteractive.audio={preRender:function(e,t){},postRender:function(e,t,n){var a=e.createDocumentFragment(),i=kInteractive.readData(t);t.setAttribute("id","ki-audio-"+n),t.innerHTML="";var r=document.createElement("div");r.setAttribute("id","ki-audio-"+n+"-container"),r.className="container";var o=document.createElement("a");o.className="playBtn ki-btn",o.appendChild(document.createElement("span")),"undefined"==typeof isKotobee&&o.addEventListener("click",kInteractive.actionEvent);var s=document.createElement("div");i.style&&kInteractive.c.addClass(s,i.style),a.appendChild(o),a.appendChild(r),s.appendChild(a),t.appendChild(s)},action:function(e){kInteractive.stopCurrentMedia();var t=kInteractive.readData(e);if(t){t.audioType||(t.audioType=t.type);e.getAttribute("id");e.getElementsByClassName("playBtn")[0].className="playBtn ki-btn hide";var n=t.src;if("file"==t.audioType&&(n="undefined"==typeof isKotobee?t.audio:t.relToRoot?ph.join(bookPath,t.audio):ph.join(kInteractive.absoluteURL,t.audio)),kInteractive.scorm){var a={};a.id=kInteractive.getScormId(e.getAttribute("id"),n),a.description="Played audio: "+n,a.type="other",a.learnerResponses="Played",a.objective=t.options?t.options.objective:null,a.timestamp=new Date,kInteractive.scorm.setInteractions([a])}kInteractive.events&&kInteractive.events.add({action:"audioPlayed",param:n,elem:e,data:t});var i=document.createElement("audio");i.setAttribute("controls","true"),i.setAttribute("autoplay","true"),i.setAttribute("data-tap-disabled","false");var r=document.createElement("source");r.src=n,i.appendChild(r),i.appendChild(document.createTextNode("Your browser does not support the audio element")),i.className="ki-noHighlight",i.oncanplay=function(){kInteractive.currentAudio==e&&kInteractive.tinCan({verb:"played",activity:"Audio: "+n})},e.getElementsByClassName("container")[0].appendChild(i),i.play(),kInteractive.currentAudio=e,kInteractive.c.addClass(kInteractive.currentAudio,"playing")}}};var log=console.log,kInteractiveCommon={checkResponsiveFloat:function(e,t){if(e&&e.disableWrapForMobile&&"none"!=e.float){var n=t.parentNode;t.offsetWidth>.6*n.offsetWidth&&.4*(n.offsetWidth-t.offsetWidth)<100?kInteractive.c.addClass(t,"fullRow"):kInteractive.c.removeClass(t,"fullRow")}},openFrame:function(u){var p=document.getElementById("kInteractiveFrame"),m=document.getElementById("kiDarkOverlay"),v="";if(u.dict||(u.dict={}),u.width&&(v+="width:"+u.width+"px;max-width:"+u.width+"px;"),u.height&&(v+="height:"+u.height+"px;max-height:"+u.height+"px;"),p||((m=document.createElement("div")).id="kiDarkOverlay",document.body.appendChild(m),m.style.display="none",m.style.position="fixed",m.addEventListener("click",kInteractive.closeFrame),(p=document.createElement("div")).id="kInteractiveFrame"),u.pos||(u.pos="top"),"none"!=u.pos){var e=document.createElement("a"),t="closeBtn";u.pos&&(t+=" "+u.pos),e.className=t;var n=u.dict.close?u.dict.close:"Close";try{n=angular.element(document.body).scope().translit("close")}catch(e){}"side"!=u.pos&&(e.innerHTML=n),e.addEventListener("click",kInteractive.closeFrame),p.appendChild(e)}var h=u.class?u.class:"";function a(){m.style.display="block",m.className="show";var e=window.innerHeight||document.documentElement.clientHeight||document.getElementsByTagName("body")[0].clientHeight,t=window.innerWidth||document.documentElement.clientWidth||document.getElementsByTagName("body")[0].clientWidth;e-=20,t-=20;var n=1;if(u.width&&u.height){var a=t/u.width,i=e/u.height;1<(n=a<i?a:i)&&(n=1)}var r="display:block;";r+=v;var o=u.width||u.height?"-50%,-50%":"0%,0%";r+="-webkit-transform:translate("+o+") scale("+n+");-moz-transform:translate("+o+") scale("+n+");transform:translate("+o+") scale("+n+");",r+="position:fixed;","undefined"==typeof isKotobee&&"-50%,-50%"==o&&(r+="top:"+Math.round(window.innerHeight/2)+"px;",r+="left:"+Math.round(window.innerWidth/2)+"px;"),-1!=h.indexOf("aspectRatio")&&window.innerWidth/window.innerHeight>16/9&&(r+="padding-bottom: "+95*window.innerHeight/Math.round(window.innerWidth)+"%"),p.style.cssText=r,p.className=h+" ready";var s=p.getElementsByClassName("closeBtn");if(s.length){var c=s[0],d=1/n,l="-50%";kInteractive.hasClass(c,"side")&&(l="0%"),c.style.cssText="-webkit-transform: translate("+l+",0%) scale("+d+");-webkit-transform-origin: 50% 50%;-moz-transform: translate("+l+",0%) scale("+d+");-moz-transform-origin: 50% 50%;transform: translate("+l+",0%) scale("+d+");transform-origin: 50% 50%;"}}(u.width||u.height)&&(h+=" fixed"),u.aspectRatio&&(h+=" aspectRatio"),p.style.display="block",p.className=h,document.body.appendChild(p),kInteractive.frameIsOpen=!0,kInteractive.frameOb=u,kInteractive.openFrame.resized=a,window.addEventListener("resize",a),setTimeout(function(){a(),u.cb&&u.cb(p)},100)},closeAlert:function(e){e&&e.stopPropagation();var t=document.getElementById("kiSystemAlertBox"),n=document.getElementById("kiSystemAlertBackdrop");t.parentNode.removeChild(t),n.parentNode.removeChild(n),kInteractive.alertIsOpen=!1,window.removeEventListener("resize",kInteractive.alert.resized),kInteractive.alert.resized=null},closeFrame:function(){var e=document.getElementById("kInteractiveFrame"),t=document.getElementById("kiDarkOverlay");kInteractive.frameIsOpen=!1,window.removeEventListener("resize",kInteractive.openFrame.resized),kInteractive.openFrame.resized=null,kInteractive.c.removeClass(e,"ready");var n=kInteractive.frameOb,a="";n.width&&(a+="width:"+n.width+"px;max-width:"+n.width+"px;"),n.height&&(a+="height:"+n.height+"px;max-height:"+n.height+"px;"),e.style.cssText=a,t.className="",setTimeout(function(){e.innerHTML="",e.style.display=t.style.display="none",n.closed&&n.closed(),kInteractive.frameOb=null},300)},stopCurrentMedia:function(){if(kInteractive.currentVideo){var e=kInteractive.currentVideo.getAttribute("id")+"-container";if(t=document.getElementById(e))t.parentNode.removeChild(t),(n=document.createElement("div")).setAttribute("id",e),n.className="container",kInteractive.currentVideo.getElementsByClassName("playBtn")[0].className="playBtn ki-btn",kInteractive.c.removeClass(kInteractive.currentVideo,"playing"),kInteractive.currentVideo.appendChild(n)}var t,n;if(kInteractive.currentAudio)if(e=kInteractive.currentAudio.getAttribute("id"))e+="-container",(t=document.getElementById(e))&&(t.parentNode.removeChild(t),(n=document.createElement("div")).setAttribute("id",e),n.className="container",kInteractive.currentAudio.getElementsByClassName("playBtn")[0].className="playBtn ki-btn",kInteractive.c.removeClass(kInteractive.currentAudio,"playing"),kInteractive.currentAudio.appendChild(n));else try{var a=kInteractive.currentAudio.getElementsByTagName("audio");a.length&&(a[0].pause(),a[0].src=""),kInteractive.currentAudio.pause&&(kInteractive.currentAudio.pause(),kInteractive.currentAudio.src="");for(var i=document.getElementsByClassName("kiAudioLoader"),r=i.length;r--;)i[r].parentNode.removeChild(i[r])}catch(e){}},hasClass:function(e,t){if(e&&e.className)for(var n=e.className.trim().split(" "),a=0;a<n.length;a++)if(n[a]&&n[a].trim()==t)return!0},appendAfterDelay:function(e,t){setTimeout(function(){e.appendChild(t)},30)},replaceHTML:function(e,t){var n="string"==typeof e?document.getElementById(e):e,a=n.cloneNode(!1);return a.innerHTML=t,n.parentNode.replaceChild(a,n),a},tinCan:function(e){if("undefined"!=typeof isKotobee)try{angular.element(document.body).scope().tinCanShortcut(e)}catch(e){}},setDOMParser:function(){!function(e){"use strict";var t=e.prototype,r=t.parseFromString;try{if((new e).parseFromString("","text/html"))return}catch(e){}t.parseFromString=function(e,t){if(/^\s*text\/html\s*(?:;|$)/i.test(t)){var n,a=document.implementation.createHTMLDocument(""),i=a.documentElement;return i.innerHTML=e,n=i.firstElementChild,1===i.childElementCount&&"html"===n.localName.toLowerCase()&&a.replaceChild(n,i),a}return r.apply(this,arguments)}}(DOMParser)},compareVersions:function(e,t){if(e==t)return 0;if(null==e)return 1;if(null==t)return-1;var n=e.split("."),a=t.split(".");return a.length?n.length?Number(n[0])>Number(a[0])?1:Number(a[0])>Number(n[0])?-1:(n.shift(1),a.shift(1),kInteractive.compareVersions(n.join("."),a.join("."))):-1:1},readData:function(e){try{var t=e.getAttribute("data-kotobee");t=t||e.getAttribute("data");var n=1;return JSON.parse(decodeURI(kInteractive.XORCipher(n).decode("kotobee%%author",t)))}catch(e){try{return JSON.parse(kInteractive.XORCipher(n).decode("kotobee%%author",t))}catch(e){}}},writeData:function(e,t,n){n=n||1;var a=encodeURI(JSON.stringify(t)),i=e.hasAttribute("data-kotobee")?"data-kotobee":"data";e.setAttribute(i,kInteractive.XORCipher(n).encode("kotobee%%author",a))},XORCipher:function(e){var u="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";return{encode:function(e,t){return function(e){var t,n,a,i,r,o,s,c,d=0,l="";if(!e)return e;for(;t=e[d++],n=e[d++],a=e[d++],i=(s=t<<16|n<<8|a)>>12&63,r=s>>6&63,o=63&s,l+=u.charAt(s>>18&63)+u.charAt(i)+u.charAt(r)+u.charAt(o),d<e.length;);return((c=e.length%3)?l.slice(0,c-3):l)+"===".slice(c||3)}(t=function(n,e){return i(e,function(e,t){return e.charCodeAt(0)^a(n,t)})}(e,t))},decode:function(e,t){return function(n,e){return i(e,function(e,t){return String.fromCharCode(e^a(n,t))}).join("")}(e,t=function(e){var t,n,a,i,r,o,s,c,d=0,l=[];if(!e)return e;e+="";for(;i=u.indexOf(e.charAt(d++)),r=u.indexOf(e.charAt(d++)),o=u.indexOf(e.charAt(d++)),s=u.indexOf(e.charAt(d++)),t=(c=i<<18|r<<12|o<<6|s)>>16&255,n=c>>8&255,a=255&c,l.push(t),64!==o&&(l.push(n),64!==s&&l.push(a)),d<e.length;);return l}(t))}};function a(e,t){return e.charCodeAt(Math.floor(t%e.length))}function i(e,t){for(var n=[],a=0;a<e.length;a++)n[a]=t(e[a],a);return n}},getScormId:function(e,t){return e+(t=t?"-"+t.replace(/[^a-zA-Z0-9]/g,"-").substr(0,80):"")},confirm:function(e){kInteractive.alert(e)},alert:function(e){if(e){var t=document.createElement("div");if(t.setAttribute("id","kiSystemAlertBox"),e.raw&&(t.className="raw"),t.style.position="fixed","undefined"==typeof isKotobee&&(t.style.top=Math.round(window.innerHeight/2)+"px",t.style.left=Math.round(window.innerWidth/2)+"px"),e.raw)t.innerHTML=e.content.replace("&nbsp;","&#160;");else{var n=document.createElement("div");n.innerHTML=e.content.replace("&nbsp;","&#160;"),n.className="content",t.appendChild(n)}if(e.title){var a=document.createElement("div");a.innerHTML=e.title.replace("&nbsp;","&#160;"),a.className="header",t.insertBefore(a,t.firstChild)}kInteractive.alertIsOpen=!0;var i=document.createElement("a");if(!e.raw){var r=document.createElement("div");r.className="footer";var o="OK";try{o=angular.element(document.body).scope().translit("ok")}catch(e){}if(e.okBtn&&(o=e.okBtn),i.innerHTML=o.replace("&nbsp;","&#160;"),i.className="okBtn",i.addEventListener("click",kInteractive.closeAlert),e.cb&&i.addEventListener("click",e.cb),r.appendChild(i),e.noBtn){var s=document.createElement("a");s.innerHTML=e.noBtn,s.className="cancelBtn",s.addEventListener("click",kInteractive.closeAlert),r.appendChild(s)}t.appendChild(r)}var c=document.createElement("div");e.noBackdrop||(c.setAttribute("id","kiSystemAlertBackdrop"),c.addEventListener("click",kInteractive.closeAlert),c.style.position="fixed",document.body.appendChild(c)),document.body.appendChild(t),i.focus(),kInteractive.alert.resized=d,window.addEventListener("resize",d),setTimeout(function(){kInteractive.c.addClass(t,"show"),kInteractive.c.addClass(c,"show")},50)}function d(){"undefined"==typeof isKotobee&&(t.style.top=Math.round(window.innerHeight/2)+"px",t.style.left=Math.round(window.innerWidth/2)+"px")}},c:{addClass:function(e,t){var n=e.className.trim();if(t instanceof Array){for(var a=!0,i=0;i<t.length;i++)-1==n.indexOf(t[i])&&(a=!1,n+=(""==n?"":" ")+t[i]);if(a)return}else{if(0<=n.indexOf(t))return;n+=(""==n?"":" ")+t}e.className=n},toggleClass:function(e,t){this.strHasClass(e.className,t)?this.removeClass(e,t):this.addClass(e,t)},hasClass:function(e,t){return this.strHasClass(e.className,t)},strHasClass:function(e,t){for(var n=(e=e||"").trim().split(" "),a=0;a<n.length;a++)if(n[a]==t)return!0;return!1},removeClass:function(e,t){var n=e.className;if(t instanceof Array){for(var a=!0,i=0;i<t.length;i++)0<=n.indexOf(t[i])&&(a=!1,n=n.replace(t[i],""));if(a)return}else{if(-1==n.indexOf(t))return;n=(n=n.replace(t,"")).replace(/ {2,}?/g," ")}""==(n=n.trim())?e.removeAttribute("class"):e.className=n},removeHash:function(e){return-1==e.indexOf("#")?e:e.substring(0,e.lastIndexOf("#"))},removeFilename:function(e){var t=kInteractive.c.normalizedArray(e);return-1==t[t.length-1].indexOf(".")?e:(t.splice(t.length-1,1),t.join("/"))},normalizedArray:function(e){for(var t=(e=e.replace(/\\/g,"/")).split("/"),n=t.length;n--;)t[n]?".."==t[n]&&0<n&&".."!=t[n-1]&&(t.splice(n,1),t.splice(n-1,1)):t.splice(n,1);return t[0].match(/http[s]?:$/g)&&(t[0]+="//"+t[1],t.splice(1,1)),"file:"==t[0]&&(t[0]+="///"+t[1],t.splice(1,1)),t},shuffleArray:function(e){e.sort(function(){return Math.random()-.5})},allowDrop:function(e){e.preventDefault()},drag:function(e){e.dataTransfer&&e.dataTransfer.setData("text",e.target.id),dragged=e.target},drop:function(e){e.preventDefault(),e.target.hasAttribute("ondragover")&&e.target.appendChild(e.view.dragged)}},escapeHtml:function(e){var t={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#039;"};return e.replace(/[&<>"']/g,function(e){return t[e]})},getChildIndex:function(e){for(var t=0;null!=(e=e.previousSibling);)t++;return t},isAbsolutePath:function(e){if(e)return 0==e.trim().indexOf("http://")||(0==e.trim().indexOf("https://")||(0==e.trim().indexOf("//")||(0==e.trim().indexOf("data:")||void 0)))},isMobile:function(e){if(/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent))return!0;try{if(0<window.location.href.indexOf("?preview")){var t=window.location.href.split("?");t=t[1].split("&");for(var n={},a=0;a<t.length;a++){var i=t[a].split("=");n[i[0]]=i[1]}if(n.mobile)return!0}}catch(e){}},closeFullscreenVideo:function(){kInteractive.currentVideo&&(kInteractive.currentVideo.webkitExitFullscreen?kInteractive.currentVideo.webkitExitFullscreen():kInteractive.currentVideo.mozCancelFullScreen?kInteractive.currentVideo.mozCancelFullScreen():document.webkitExitFullscreen?document.webkitExitFullscreen():document.mozCancelFullScreen&&document.mozCancelFullScreen(),kInteractive.videoIsFullscreen=!1)},getWidgetHome:function(e,t){return{},e.path?"undefined"==typeof isKotobee?e.path:ph.join(angular.element(document.body).scope().data.book.chapter.absoluteURL,e.path):"undefined"==typeof isKotobee?"../js/widgets/":bookPath+"EPUB/js/widgets/"},getWidgetUrl:function(e,t){var n=kInteractive.getWidgetHome(e,t)+"/"+e.name+"/"+e.src;if("undefined"!=typeof isKotobee){var a=angular.element(document.body).scope().data.user;a&&a.email&&a.signatures&&a.signatures.bookwidgets&&e.id&&0==e.id.indexOf("com.kidimedia")&&(n+="?oauth_signature="+a.signatures.bookwidgets.signature,n+="&oauth_nonce="+a.signatures.bookwidgets.nonce,n+="&oauth_timestamp="+a.signatures.bookwidgets.timestamp,n+="&oauth_consumer_key="+a.signatures.bookwidgets.key,n+="&lti_version=LTI-1p0",n+="&oauth_signature_method=HMAC-SHA1",n+="&oauth_version=1.0",n+="&tool_consumer_info_product_family_code=kotobee",n+="&lis_person_contact_email_primary="+a.email,n+="&lis_person_name_full="+(a.name?a.name:""),n+="&user_id="+a.id,n+="&lti_message_type=basic-lti-launch-request",angular.element(document.body).scope().refreshSignatures&&angular.element(document.body).scope().refreshSignatures())}return n},clearAudioVideo:function(e){var t=e||document;kInteractive.stopCurrentMedia();for(var n=t.getElementsByTagName("audio"),a=n.length;a--;)try{if(n[a].hasAttribute("data-dontclose"))continue;n[a].pause(),n[a].children.length||(n[a].src="")}catch(e){}var i=t.getElementsByTagName("video");for(a=i.length;a--;)i[a].pause(),i[a].children.length||(i[a].src="")}};for(var item in kInteractiveCommon)kInteractive[item]=kInteractiveCommon[item];kInteractive.container={preRender:function(e,t){kInteractive.readData(e)},postRender:function(e,t,n){var a=kInteractive.readData(t);if(a&&(kInteractive.isMobile()&&"cScroll"==a.type&&"undefined"!=typeof isKotobee&&angular.element(document.body).scope().applyNativeScroll(t),a.path)){var i=a.path;"undefined"!=typeof isKotobee&&(i=ph.join(kInteractive.absoluteURL,a.path));var r=t.getAttribute("style");t.setAttribute("style",r+' background-image:url("'+i+'");')}},action:function(e){},resize:function(e){var t=kInteractive.readData(e);t&&kInteractive.checkResponsiveFloat(t,e)}},kInteractive.gallery={preRender:function(e,t){var n=t.createDocumentFragment(),a=kInteractive.readData(e);if(a){e.innerHTML="";var i=document.createElement("div");i.className="imgMask";var r=document.createElement("div");r.className="images "+a.scale,i.appendChild(r);for(var o=0;o<a.imgs.length;o++){var s=document.createElement("div");s.className="imgContainer"+(o?"":" selected");var c="undefined"==typeof isKotobee?a.imgs[o].path:ph.join(kInteractive.absoluteURL,a.imgs[o].path);s.setAttribute("style","background-color:"+a.bgColor+";background-image:url('"+c+"')"+(o?"":";display:block")),a.imgs[o].caption&&s.setAttribute("data-caption",a.imgs[o].caption),r.appendChild(s)}n.appendChild(i);var d=document.createElement("div");d.className="imgCaption";var l=document.createElement("div");l.className="inner",l.style.display="none",a.imgs[0]&&a.imgs[0].caption&&(l.innerHTML=a.imgs[0].caption,l.style.display=null),d.appendChild(l),n.appendChild(d);var u=document.createElement("a");u.className="next btn ki-btn",1==a.imgs.length&&(u.className+=" disable"),n.appendChild(u);var p=document.createElement("a");p.className="prev btn ki-btn disable",n.appendChild(p),"undefined"==typeof isKotobee&&(u.addEventListener("click",kInteractive.actionEvent),p.addEventListener("click",kInteractive.actionEvent));var m=document.createElement("div");a.style&&kInteractive.c.addClass(m,a.style),m.appendChild(n),e.appendChild(m)}},postRender:function(e,t,n){},action:function(e,t){var n=e.getElementsByClassName("images")[0],a=(n.children.length,e.getElementsByClassName("selected")[0]),i=Number(a.style.left.slice(0,-2)),r=Number(n.style.left.slice(0,-2));if(kInteractive.hasClass(t,"next")){var o=a.nextSibling;if(!o)return;kInteractive.c.removeClass(a,"selected"),kInteractive.c.addClass(o,"selected"),o.style.left=i+n.offsetWidth+"px",o.style.display="block",n.style.left=r-n.offsetWidth+"px",o.nextSibling?kInteractive.c.removeClass(t,"disable"):kInteractive.c.addClass(t,"disable"),kInteractive.c.removeClass(e.getElementsByClassName("prev")[0],"disable"),a=o}else if(kInteractive.hasClass(t,"prev")){var s=a.previousSibling;if(!s)return;kInteractive.c.removeClass(a,"selected"),kInteractive.c.addClass(s,"selected"),s.style.left=i-n.offsetWidth+"px",s.style.display="block",n.style.left=r+n.offsetWidth+"px",s.previousSibling?kInteractive.c.removeClass(t,"disable"):kInteractive.c.addClass(t,"disable"),kInteractive.c.removeClass(e.getElementsByClassName("next")[0],"disable"),a=s}var c=e.getElementsByClassName("imgCaption");if(c.length){var d=(c=c[0]).getElementsByClassName("inner");d.length&&((d=d[0]).style.display="none",a.hasAttribute("data-caption")&&(d.innerHTML=a.getAttribute("data-caption"),d.style.display=null))}},resize:function(e){var t=kInteractive.readData(e);t&&kInteractive.checkResponsiveFloat(t,e)}},kInteractive.image={preRender:function(e,t){var n=kInteractive.readData(e);n&&(n.style&&kInteractive.c.addClass(e,n.style),n.popup&&n.splash&&(e.src=n.splash),e.parentNode&&kInteractive.hasClass(e.parentNode,"link")||"undefined"==typeof isKotobee&&e.addEventListener("click",kInteractive.actionEvent))},postRender:function(e,t,n){kInteractive.readData(t)},action:function(e,a,t){if(a.parentNode&&kInteractive.hasClass(a.parentNode,"kInteractive")&&kInteractive.hasClass(a.parentNode,"link"))kInteractive.action(a.parentNode,event);else{var n=kInteractive.readData(a);if(n){var i=n.behavior;if("none"!=i)s(a,"none"),c(a,"none"),d(a,"none"),setTimeout(function(){"wiggle"==i?(s(a,"wiggle"),c(a,"0.5s"),d(a,"1")):"jump"==i?(s(a,"jump"),c(a,"0.7s"),d(a,"1")):"scale"==i&&(s(a,"scale"),c(a,"0.5s"),d(a,"1"));var n=function(){var e,t=document.createElement("fakeelement"),n={animation:"animationend",OAnimation:"oAnimationEnd",MozAnimation:"animationend",WebkitAnimation:"webkitAnimationEnd"};for(e in n)if(void 0!==t.style[e])return n[e]}();n&&a.addEventListener(n,function e(t){s(a,"none"),c(a,"none"),d(a,"none"),a.removeEventListener(n,e)})}),kInteractive.tinCan({verb:"clicked",activity:i+"image: "+a.getAttribute("src")});else if(n.popup){var r={class:"image"},o=document.createElement("img");o.src=n.path,kInteractive.isAbsolutePath(n.path)||"undefined"!=typeof isKotobee&&(o.src=ph.join(kInteractive.absoluteURL,n.path)),r.width=o.naturalWidth,r.height=o.naturalHeight,r.pos="side",r.cb=function(e){e.appendChild(o)},r.closed=function(){},kInteractive.openFrame(r)}}}function s(e,t){e.style.webkitAnimation=e.style.mozAnimation=e.style.animation=t}function c(e,t){e.style.webkitAnimationDuration=e.style.mozAnimationDuration=e.style.animationDuration=t}function d(e,t){e.style.webkitAnimationIterationCount=e.style.mozAnimationIterationCount=e.style.animationIterationCount=t}},resize:function(e){var t=kInteractive.readData(e);t&&kInteractive.checkResponsiveFloat(t,e)}},kInteractive.link={preRender:function(e,t){var n=kInteractive.readData(e);if(n&&("undefined"==typeof editorMode||!editorMode)){if("div"==e.nodeName.toLowerCase()){var a=document.createElement("a");a.setAttribute("href","popup"==n.type?"":e.getAttribute("href")),a.setAttribute("target",n.target),a.setAttribute("style",e.getAttribute("style")),a.setAttribute("data-kotobee",e.getAttribute("data-kotobee")),a.className=e.className,a.id=e.id?e.id:n.id,kInteractive.c.addClass(a,"btn"),a.style.opacity=Number(n.transparency)/100,e.parentNode.replaceChild(a,e),e=a}"undefined"==typeof isKotobee&&("popup"!=n.type&&"audio"!=n.type&&"action"!=n.type||e.setAttribute("onclick","return false;"),e.addEventListener("click",kInteractive.actionEvent))}},postRender:function(e,t,n){},action:function(t,e,n){var a=kInteractive.readData(e);if(a){if("popup"==a.type){var i="<div class='kbAlertScroll'>"+a.msg+"</div>";if(i=i.replace(/src="(.*?)"/g,function(){var e=arguments[1];return"undefined"!=typeof isKotobee&&(e=ph.join(kInteractive.absoluteURL,e)),'src="'+e+'"'}),"image"==a.popupMode){var r=a.popupImg;"undefined"!=typeof isKotobee&&(r=ph.join(kInteractive.absoluteURL,r)),i="<img src='"+r+"'/>"}kInteractive.alert({content:i}),setTimeout(function(){if(kInteractive.scorm){var e={};e.id=kInteractive.getScormId("popup",a.msg),e.description="Shown popup message: "+a.msg,e.type="other",e.learnerResponses="Shown",e.timestamp=new Date,kInteractive.scorm.setInteractions([e])}kInteractive.events&&kInteractive.events.add({action:"popup",param:a.msg,elem:t,data:qsData})})}else if("action"==a.type){var o=a.asset,s=a.action;if(o.remote){if("widget"==o.type){var c=document.createElement("div");c.className="kInteractive widget kbHidden",c.setAttribute("data-kotobee",o.data),document.body.appendChild(c),kInteractive.trigger("click",c)}return}for(var d=document.getElementsByClassName(o.classname),l=0;l<d.length;l++)if(kInteractive.hasClass(d[l],"kInteractive")&&kInteractive.hasClass(d[l],o.type))if("activate"==s)if("gallery"==o.type){var u=d[l].getElementsByClassName("next");kInteractive.trigger("click",u[0])}else if("questions"==o.type){for(var p=d[l].getElementsByClassName("ki-btn"),m=0;m<p.length;m++)if("submit"==p[m].type){kInteractive.trigger("click",p[m]);break}}else kInteractive.trigger("click",d[l]);else"visibility"==s&&kInteractive.c.toggleClass(d[l],"kbHidden")}else if("audio"==a.type){kInteractive.stopCurrentMedia();var v,h=document.createElement("audio"),f=a.src;function g(){v||(kInteractive.c.addClass(b,"hide"),v=!0)}"file"==a.audioType&&(f="undefined"==typeof isKotobee?a.audio:ph.join(kInteractive.absoluteURL,a.audio)),h.setAttribute("src",f);var k=document.createElement("div");k.className="kiAudioLoader",k.style.transform=k.style.webkitTransform=k.style.mozTransform="scale(1)";var b=document.createElement("div");if(b.className="kiAudioSpinner",k.appendChild(b),e.parentNode.insertBefore(k,e),h.onplaying=g,setTimeout(g,5e3),h.play(),kInteractive.currentAudio=h,kInteractive.tinCan({verb:"played",activity:"Audio: "+f}),kInteractive.scorm){var y={};y.id=kInteractive.getScormId(e.textContent,f),y.description="Played audio link: "+f,y.type="other",y.learnerResponses="Played",y.objective=a.options?a.options.objective:null,y.timestamp=new Date,kInteractive.scorm.setInteractions([y])}kInteractive.events&&kInteractive.events.add({action:"audioLinkClicked",param:f,elem:t,data:a})}else if("attachment"==a.type){var I=a.file;"undefined"!=typeof isKotobee&&(I=ph.join(kInteractive.absoluteURL,a.file));var C=document.createElement("a");document.body.appendChild(C),C.setAttribute("style","display: none"),C.href=I,C.target="_blank",C.download=a.file.split("/")[a.file.split("/").length-1],C.setAttribute("onclick","");var E=document.createEvent("MouseEvents");E.initMouseEvent("click"),C.dispatchEvent(E),C.remove()}return!1}}},kInteractive.questions={preRender:function(e,t,n,a){var i=t.createDocumentFragment(),r=kInteractive.readData(e);if(r){var o=r.dict,s=r.userDict;if(o=o||{},s=s||o,r.options||(r.options={}),e.id||(e.id="ki-qs-"+n+"-"+Math.ceil(1e3*Math.random())),e.innerHTML="",r.layout&&r.layout.popup&&!kInteractive.hasClass(e,"inpopup")){var c=document.createElement("img"),d=r.layout.popupImg;return c.src=d,i.appendChild(c),"undefined"==typeof isKotobee&&c.addEventListener("click",kInteractive.actionEvent),void e.appendChild(i)}if(r.options.randomize){for(var l=0;l<r.q.length;l++)r.q[l].origin=l;for(var u,p,m=r.q.length;0!==m;)p=Math.floor(Math.random()*m),m-=1,u=r.q[m],r.q[m]=r.q[p],r.q[p]=u}if(r.options.questionsDisplayed){var v=Number(r.options.questionsDisplayed);r.q=r.q.slice(0,v)}if(r.title){var h=document.createElement("span");h.innerHTML="<h4>"+kInteractive.escapeHtml(r.title)+"</h4>",i.appendChild(h)}var f=null;r.options&&r.options.emailForm&&(f=this.f.createEmailForm(s));var g=null;"none"!=r.action&&(g=this.f.createSubmitBtn(s,e));var k=null,b=null,y=null;r.options&&r.options.clearAnswers&&(k=this.f.createClearBtn(s)),r.options&&r.options.addToNotebook&&(y=this.f.createAddToNotebookBtn(s)),r.options&&r.options.preserveAnswers&&(b=this.f.createPreserveBtn(s,e));var I=this.f.createSeparator(),C=document.createElement("div");C.className="qContainer";var E=document.createElement("div");if(E.className="btnContainer","slides"==r.options.displayMode)e.qIndex=0,C.appendChild(kInteractive.questions.f.createQElem(r,0,e)),i.appendChild(C),i.appendChild(E),kInteractive.questions.f.showNavBtns(0,i,{isFrag:!0,userDict:s,qsData:r});else{for(l=0;l<r.q.length;l++)C.appendChild(kInteractive.questions.f.createQElem(r,l,e));i.appendChild(C),f&&E.appendChild(f),g&&E.appendChild(g),E.appendChild(document.createTextNode(" ")),y&&E.appendChild(y),k&&E.appendChild(k),b&&E.appendChild(b),I&&i.appendChild(I),i.appendChild(E)}r.options.rtl?(e.style.direction="rtl",kInteractive.c.addClass(e,"rtl")):e.style.direction="ltr";var w=document.createElement("div");r.style&&kInteractive.c.addClass(w,r.style),w.appendChild(i),e.appendChild(w)}},postRender:function(e,t,n){var a=kInteractive.readData(t);if(a){var i=a.dict,r=a.userDict;i=i||{},r=r||i;for(var o=t.getElementsByClassName("ques"),s=t.getElementsByClassName("explanation"),c=s.length;c--;)s[c].parentNode.removeChild(s[c]);var d=t.getElementsByClassName("reference");for(c=d.length;c--;)d[c].parentNode.removeChild(d[c]);for(var l=0;l<o.length;l++){var u=o[l].getElementsByClassName("ans"),p=(u.length,l);if(a.options.randomize&&(p=Number(o[l].getAttribute("data-o"))),document[t.id]&&document[t.id].preserve&&document[t.id].q&&document[t.id].q[p]){if(a.q[p].exp)if(!o[l].getElementsByClassName("explanation").length){var m=document.createElement("p");m.className="explanation",m.innerHTML=kInteractive.escapeHtml(a.q[p].exp),kInteractive.appendAfterDelay(o[l],m)}if(a.q[p].ref)if(!o[l].getElementsByClassName("reference").length){var v=document.createElement("a");v.className="reference",v.innerHTML=r.learnMode?r.learnMode:"Learn more",v.setAttribute("href",kInteractive.escapeHtml(a.q[p].ref)),v.setAttribute("target","_blank"),kInteractive.appendAfterDelay(o[l],v)}}for(c=0;c<u.length;c++)if(kInteractive.c.removeClass(u[c].parentNode,"correct"),0<=u[c].getAttribute("id").indexOf("ki-tf-"))document[t.id]&&document[t.id].preserve&&document[t.id].q&&document[t.id].q[p]&&(document[t.id].q[p][c]?u[c].setAttribute("checked",!0):u[c].removeAttribute("checked"),a.options&&a.options.highlightCorrect&&(0==c&&a.q[p].a||1==c&&!a.q[p].a)&&kInteractive.c.addClass(u[c].parentNode,"correct"));else if(0<=u[c].getAttribute("id").indexOf("ki-dd-")){if(document[t.id]&&document[t.id].preserve&&document[t.id].q&&document[t.id].q[p])for(var h=0;h<document[t.id].q[p].length;h++){var f=document[t.id].q[p][h];try{for(var g=document.getElementById(f.id),k=g;!kInteractive.c.hasClass(k,"ques");)k=k.parentNode;k.getElementsByClassName("categoryContainer")[0].children[f.category].appendChild(g)}catch(e){}}}else 0<=u[c].getAttribute("id").indexOf("ki-sa-")?document[t.id]&&document[t.id].preserve&&document[t.id].q&&document[t.id].q[p]&&(u[c].removeAttribute("value"),document[t.id].q[p]&&u[c].setAttribute("value",document[t.id].q[p])):document[t.id]&&document[t.id].preserve&&document[t.id].q&&document[t.id].q[p]&&(document[t.id].q[p][c]?u[c].setAttribute("checked",!0):u[c].removeAttribute("checked"),a.options&&a.options.highlightCorrect&&a.q[p].c[c].a&&kInteractive.c.addClass(u[c].parentNode,"correct"));if(document[t.id]){var b=t.getElementsByClassName("questions-preserve");b.length&&(document[t.id].preserve?b[0].setAttribute("checked",!0):b[0].removeAttribute("checked"))}}}},action:function(m,t,e){var n=kInteractive.readData(m);if(n){var a=n.dict,i=n.userDict;if(a=a||{},i=i||a,n.layout&&n.layout.popup&&!kInteractive.hasClass(m,"inpopup")&&"img"==t.nodeName.toLowerCase()){function r(e){for(var t=0;e=e.previousSibling;)"#text"!=e.nodeName&&8!=e.nodeType&&t++;return t}var o=document.getElementById("epubContent");o&&m.setAttribute("data-loc",function(e,t){for(var n="";e!=t;){n=r(e)+"."+n,e=e.parentNode}return""==n?"":n.substr(0,n.length-1)}(m,o));var v=document.createElement("iframe");return v.setAttribute("nwdisable","true"),v.setAttribute("nwfaketop","true"),n.cb=function(e){var t,n=document.createElement("head");if("undefined"==typeof isKotobee){for(var a=document.getElementsByTagName("link"),i=0;i<a.length;i++){var r=a[i];if(0<=r.getAttribute("href").indexOf("base.css")){var o=r.getAttribute("href").split("/");delete o[o.length-1],t=o.join("/");break}}if(!t)return}var s="undefined"==typeof isKotobee?t+"../xhtml/":bookPath+"EPUB/xhtml/";n="<head>";if(n+='<base href="'+kInteractive.c.removeFilename(kInteractive.c.removeHash(window.location.href))+"/"+s+'"/>',n+='<link rel="stylesheet" type="text/css" href="../css/base.css" />',n+='<link rel="stylesheet" type="text/css" href="../css/global.css" />',n+='<link rel="stylesheet" type="text/css" href="../css/kotobeeInteractive.css" />',n+='<script type="text/javascript" src="../js/kotobeeInteractive.js"><\/script>',n+='<script type="text/javascript" src="../js/global.js"><\/script>',"undefined"!=typeof isKotobee){var c=clone(config);c.kotobee.email=angular.element(document.body).scope().data.user.email,n+='<script type="text/javascript">var config='+JSON.stringify(c)+";<\/script>"}n+='<meta charset="utf-8" />',n+="</head>";var d=m.outerHTML;d=(d=(d=(d=(d=(d=d.replace("<img",'<img style="display:none"')).replace(/([;\s]*?height:)(.*)?;/i,"$1auto")).replace(/([;\s]*?width:)(.*)?;/i,"$1auto")).replace(/([;\s]*?top:)(.*)?;/i,"$1auto")).replace(/([;\s]*?left:)(.*)?;/i,"$1auto")).replace('class="','class="inpopup ');var l="<html>"+n+"<body>"+(d+='<div class="vSpace20"></div>')+"</body></html>";v.setAttribute("srcdoc",l);var u="javascript: window.frameElement.getAttribute('srcdoc');";function p(){if("undefined"!=typeof isKotobee){var e={};e.root=v.contentDocument.documentElement.ownerDocument.body,e.rootIndex=m.getAttribute("data-loc"),angular.element(document.body).scope().getNotebookShortcut(e,function(){})}}v.setAttribute("src",u),v.contentWindow&&(v.contentWindow.location=u),e.appendChild(v),v.addEventListener?v.addEventListener("load",p,!0):v.attachEvent&&v.attachEvent("onload",p)},n.closed=function(){},n.pos=n.layout.pos,kInteractive.openFrame(n),kInteractive.tinCan({verb:"opened",activity:"Questions: "+n.title}),void setTimeout(function(){if(kInteractive.scorm){var e={};e.id=kInteractive.getScormId("question",n.title),e.description="Opened question popup: "+n.title,e.learnerResponses="Opened",e.type="other",e.timestamp=new Date,kInteractive.scorm.setInteractions([e])}kInteractive.events&&kInteractive.events.add({action:"questionPopup",param:n.title,elem:m,data:n})},800)}if(!kInteractive.hasClass(t,"kInteractive")){if(kInteractive.hasClass(t,"questions-next")){var s=m.qIndex?m.qIndex:0;if(++s<0)return;if(s>=n.q.length)return;var c=(N=m.getElementsByClassName("qContainer")[0]).children[0];if(n.options.strictNav)if(!(B=kInteractive.questions.f.assess(c,n.q[s-1],n)).correct)return;m.getElementsByClassName("btnContainer")[0];return N.innerHTML="",N.appendChild(kInteractive.questions.f.createQElem(n,s,m)),c&&(m.questions||(m.questions=[]),m.questions.push(c)),kInteractive.questions.f.showNavBtns(s,m,{userDict:i,qsData:n}),void(m.qIndex=s)}if(kInteractive.hasClass(t,"questions-prev")){if(!m.questions)return;if(!m.questions.length)return;s=m.qIndex?m.qIndex:0;return s--,(N=m.getElementsByClassName("qContainer")[0]).innerHTML="",N.appendChild(m.questions.pop()),kInteractive.questions.f.showNavBtns(s,m,{userDict:i,qsData:n}),void(m.qIndex=s)}if(kInteractive.hasClass(t,"questions-clear")){for(var d=m.getElementsByClassName("ans"),l=[],u=0;u<d.length;u++)d[u].checked=!1,d[u].value=null,kInteractive.c.removeClass(d[u].parentNode,"correct"),kInteractive.c.removeClass(d[u],"incorrect"),kInteractive.c.hasClass(d[u].parentNode,"dCategory")&&l.push(d[u]);for(u=0;u<l.length;u++)l[u].parentNode.parentNode.parentNode.getElementsByClassName("ki-dd-answers")[0].appendChild(l[u]);for(u=(M=m.getElementsByClassName("explanation")).length;u--;)M[u].parentNode.removeChild(M[u]);for(u=(S=m.getElementsByClassName("reference")).length;u--;)S[u].parentNode.removeChild(S[u]);document[m.id]=null}else{if(kInteractive.hasClass(t,"questions-notebook")){var p,h=n.layout&&n.layout.popup&&kInteractive.hasClass(m,"inpopup");if("undefined"==typeof isKotobee&&!h)return void kInteractive.alert({content:a.kotobeeOnly,title:i.sorry?i.sorry:"Sorry"});var f={elem:m};if("undefined"!=typeof isKotobee)p=angular.element(document.body).scope();else{try{p=window.parent.getGlobal()}catch(e){return void kInteractive.alert({content:a.kotobeeOnly,title:i.sorry?i.sorry:"Sorry"})}f.rootIndex=m.getAttribute("data-loc"),f.root=m}return kInteractive.c.addClass(t,"busy"),void p.questionsAddToNotebookShortcut(f,function(){kInteractive.c.removeClass(t,"busy"),kInteractive.alert({content:i.savedToNotebook?i.savedToNotebook:"Saved to notebook!"})})}if(kInteractive.hasClass(t,"questions-preserve"))return document[m.id]||(document[m.id]={}),void(document[m.id].preserve=t.checked);if(kInteractive.hasClass(t,"questions-submit")){var g="Untitled questions",k=m.getElementsByTagName("h4");k.length&&(g=k[0].textContent||k[0].data);var b,y=0,I="",C=0,E=0,w=[];if("slides"==n.options.displayMode){b=m.questions.slice(0);var N=m.getElementsByClassName("qContainer")[0];b.push(N.children[0])}else b=m.getElementsByClassName("ques");var A=b.length;for(u=0;u<b.length;u++)if(!kInteractive.hasClass(b[u],"sp")){var x=0<(d=b[u].getElementsByClassName("ans")).length,q=n.q[u];if(n.options.randomize&&(q=n.q[Number(b[u].getAttribute("data-o"))]),q.q||(q.q=""),kInteractive.scorm&&n.options&&n.options.answerOnce&&kInteractive.scorm.interactionExists(kInteractive.getScormId(m.id+"-"+(u+1),q.q))){var L="<p style='text-align:center'>"+(i.alreadySubmitted?i.alreadySubmitted:"This test has already been submitted!")+"</p>";return void kInteractive.alert({content:L})}var T={},R=d[0].getAttribute("id");w.push(T),T.id=kInteractive.getScormId(m.id+"-"+(u+1),q.q),T.qid=m.id,0<=R.indexOf("ki-tf-")?T.type="true-false":0<=R.indexOf("ki-mcq-")||R.indexOf("ki-mmcq-")?T.type="choice":0<=R.indexOf("ki-dd-")?T.type="drag-drop":0<=R.indexOf("ki-sa-")&&(T.type="short-answer"),T.objective=n.options?n.options.objective:null,T.timestamp=kInteractive.timestamp,T.latency=Math.round(((new Date).getTime()-kInteractive.timestamp.getTime())/1e3),T.description=q.q;var B,H=[];(B=kInteractive.questions.f.assess(b[u],q,n)).correctResponses&&(T.correctResponses=B.correctResponses),B.learnerResponses&&(T.learnerResponses=B.learnerResponses),H=(H=B.ddInteractionOb)||[];var M,S;x=B.correct;if(H.length)for(var D=0;D<H.length;D++)T.correctResponses&&(T.correctResponses+="; "),T.learnerResponses&&(T.learnerResponses+="; "),T.correctResponses+=H[D].correct,T.learnerResponses+=H[D].learner;if(T.result=0,null!=q.weight&&(C+=q.weight,x&&(E+=q.weight,T.result=q.weight)),T.scoreMax=n.options?Number(n.options.totalScore):null,q.exp)if(!b[u].getElementsByClassName("explanation").length)(M=document.createElement("p")).className="explanation",M.innerHTML=kInteractive.escapeHtml(q.exp),kInteractive.appendAfterDelay(b[u],M);if(q.ref)if(!b[u].getElementsByClassName("reference").length)(S=document.createElement("a")).className="reference",S.innerHTML=i.learnMode?i.learnMode:"Learn more",S.setAttribute("href",kInteractive.escapeHtml(q.ref)),S.setAttribute("target","_blank"),kInteractive.appendAfterDelay(b[u],S);var O=i.question?i.question.replace("[no]",u+1):"Question "+(u+1);x?(I+="<span style='border-bottom: dotted 1px #aaa;' title='"+q.q.replace(/'/g,"&#39;")+"'>"+O+".</span>  <span style='color:#366c20'>"+i.correct+"</span><br/>",y++):I+="<span style='border-bottom: dotted 1px #aaa;' title='"+q.q.replace(/'/g,"&#39;")+"'>"+O+".</span>  <span style='color:#7a1818'>"+i.incorrect+"</span><br/>"}for(u=0;u<w.length;u++)w[u].weighting=Math.round(1e3*n.options.totalScore/C)/1e3;function F(){var e="Questions: "+g+". Score: "+y+" questions out of "+A;e+=". Action: "+P,"selfAnswerReport"==P&&(e+=". Details: "+I),kInteractive.tinCan({verb:"solved",activity:e})}var z,P=n.action;if(n.options.totalScore&&C&&(z=Math.round(10*n.options.totalScore*E/C)/10),"selfAnswer"==P||"selfAnswerReport"==P){var K="";"ar"==n.options.language&&(K=' direction="rtl"');L="";if(i.scoreWeight){if(null!=z){var j="";n.options.passScore&&(z>=n.options.passScore||z==n.options.totalScore?j+=i.pass:j+=i.fail),j&&(j+=". "),L+="<h3"+K+">"+(j||"")+i.scoreWeight.replace("[score]",z).replace("[total]",n.options.totalScore)+"</h3>"}L+="<p"+K+">"+i.score.replace("[correct]",y).replace("[total]",A)+"</p>"}else L="You scored "+y+" question(s) out of "+A;"selfAnswerReport"==P&&(L="<p"+K+"><strong>"+L+"</strong></p><p><strong>"+(i.details?i.details:"Details")+"</strong></p><p class='kbAlertScroll'>"+I+"</p>"),kInteractive.alert({content:L}),F()}if("email"==P||n.options.reportEmail||n.options.emailForm){var U="selfAnswer"!=P&&"selfAnswerReport"!=P&&"email"!=P;try{if(!config.kotobee.cloudid)return void(U&&kInteractive.alert({content:a.cloudOnly,title:i.sorry?i.sorry:"Sorry"}))}catch(e){return void(U&&kInteractive.alert({content:a.cloudOnly,title:i.sorry?i.sorry:"Sorry"}))}var W={};W.ans=new Array;for(var _=0;_<b.length;_++)for(d=b[_].getElementsByClassName("ans"),u=0;u<d.length;u++)d[u].checked&&W.ans.push({q:_,index:u,label:d[u].nextSibling.textContent||d[u].nextSibling.data});W.title=g;var V={};if(V.recipient=n.address,n.options.reportEmail&&(V.recipient=n.options.reportEmail),V.content=JSON.stringify(W),V.mode=config.kotobee.mode,V.cloudid=config.kotobee.cloudid,V.email=config.kotobee.email?config.kotobee.email:angular.element(document.body).scope().data.user.email,n.options.emailForm){var Q=document.getElementsByName("recipientEmail");Q.length&&(V.recipient=V.recipient?V.recipient+","+Q[0].value:Q[0].value)}var Y=t.value;t.value=i.submitting?i.submitting:"Submitting ..",t.setAttribute("disabled","true");var J=new XMLHttpRequest;J.onreadystatechange=function(){try{if(4===J.readyState&&200===J.status){if(t.value=Y,t.removeAttribute("disabled"),!U)return;JSON.parse(J.responseText).success?kInteractive.alert({content:i.submitted?i.submitted:"Answers submitted!"}):kInteractive.alert({content:i.errorSubmitting?i.errorSubmitting:"An error has occurred while sending answers to the server"})}}catch(e){if(t.value=Y,t.setAttribute("value",t.value),t.removeAttribute("disabled"),!U)return;kInteractive.alert({content:i.errorSubmitting?i.errorSubmitting:"An error has occurred while sending answers to the server"})}};var X=config.kotobee.liburl?config.kotobee.liburl:"http://www.kotobee.com/";X+="library/report/questions",J.open("POST",X),J.setRequestHeader("Content-type","application/x-www-form-urlencoded");var $="a=a";for(var G in V){var Z;null!=(Z=V[G])&&"object"!=typeof Z&&("string"==typeof Z&&(Z=encodeURIComponent(Z)),"boolean"==typeof Z&&(Z=Z?1:0),$+="&"+G+"="+Z)}J.send($),F()}document[m.id]||(document[m.id]={}),document[m.id].q=[];var ee=m.getElementsByClassName("ques");for(_=0;_<ee.length;_++){var te=_;n.options.randomize&&(te=Number(ee[_].getAttribute("data-o"))),document[m.id].q[te]=[];var ne=ee[_].getElementsByClassName("ans");for(u=0;u<ne.length;u++)kInteractive.hasClass(ne[u],"txtfield")?document[m.id].q[te][u]=ne[u].value:ne[u].type&&"checkbox"==ne[u].type.toLowerCase()?document[m.id].q[te][u]=ne[u].checked:ne[u].type&&"radio"==ne[u].type.toLowerCase()?document[m.id].q[te][u]=ne[u].checked:kInteractive.c.hasClass(ne[u].parentNode,"dCategory")&&(document[m.id].q[te][u]={id:ne[u].id,category:kInteractive.getChildIndex(ne[u].parentNode)})}setTimeout(function(){kInteractive.scorm&&kInteractive.scorm.setInteractions(w),kInteractive.events&&kInteractive.events.add({action:"questionsSubmitted",param:g,elem:m,data:n})},500)}}}}},f:{createQElem:function(e,t,n){var a=this.getQId(n),i=e.q[t],r=document.createElement("div");r.className="ques",null!=i.origin&&r.setAttribute("data-o",i.origin),i.q||(i.q="");"undefined"!=typeof config&&config.v;var o=e.options.numbering;"sp"==i.type&&(o=!1),i.q=i.q.replace(/<html.*<body>(.*?)<\/body><\/html>/g,"$1");try{r.innerHTML="<div class='questionTxt'><strong>"+(o?"<span class='no'>"+(t+1)+"</span>":"")+"</strong> "+i.q+"</div>"}catch(e){r.innerHTML="<div class='questionTxt'><strong>"+(o?"<span class='no'>"+(t+1)+"</span>":"")+kInteractive.escapeHtml(" "+i.q)+"</strong></div>"}if(i.path){var s=document.createElement("img");s.src=i.path,r.appendChild(s)}if(r.classList.add(i.type),"sp"==i.type&&(i.topBorder&&kInteractive.c.addClass(r,"topBorder"),i.bottomBorder&&kInteractive.c.addClass(r,"bottomBorder"),kInteractive.c.addClass(r,"separator")),"sa"==i.type){var c=i.lines?i.lines:1,d=document.createElement(1<c?"textarea":"input"),l="ki-sa-"+a+"-"+t;d.id=l,d.name="sa-"+a+"-"+t,1==c?d.type="text":d.rows=i.lines?i.lines:1,d.className="ki-textfield ans txtfield",document[item.id]&&document[item.id].preserve&&document[item.id].q&&document[item.id].q[t]&&(d.value=document[item.id].q[t]),r.appendChild(d)}else if("mcq"==i.type||"mmcq"==i.type)for(var u=i.c,p=0;p<u.length;p++){l="ki-mcq-"+a+"-"+t+"-"+p;var m=document.createElement("input");m.id=l,"mmcq"==i.type?(m.name="name",m.type="checkbox"):(m.name="mcq-"+a+"-"+t,m.type="radio"),m.className="ki-inputbox ans",(v=document.createElement("label")).htmlFor=l,v.innerHTML=" "+kInteractive.escapeHtml(u[p].t),v.className="ki-noHighlight",(f=document.createElement("div")).className="answer",document[item.id]&&document[item.id].preserve&&document[item.id].q&&document[item.id].q[t]&&(m.checked=document[item.id].q[t][p],e.options&&e.options.highlightCorrect&&i.c[p].a&&kInteractive.c.addClass(f,"correct")),f.appendChild(m),f.appendChild(v),r.appendChild(f)}else if("tf"==i.type)for(p=0;p<2;p++){l="ki-tf-"+a+"-"+t+"-"+p;var v,h=document.createElement("input");h.type="radio",h.className="ki-inputbox ans",h.id=l,h.name="tf-"+a+"-"+t,(v=document.createElement("label")).htmlFor=l,i.choice1&&i.choice2?v.innerHTML=kInteractive.escapeHtml(" "+(0==p?i.choice1:i.choice2)):v.innerHTML=" "+(0==p?"True":"False"),v.className="ki-noHighlight";var f=document.createElement("div");document[item.id]&&document[item.id].preserve&&document[item.id].q&&document[item.id].q[t]&&(h.checked=document[item.id].q[t][p],e.options&&e.options.highlightCorrect&&(0==p&&i.a||1==p&&!i.a)&&kInteractive.c.addClass(f,"correct")),f.appendChild(h),f.appendChild(v),r.appendChild(f)}else if("dd"==i.type){var g=document.createElement("div");g.className="categoryContainer";var k=[];for(p=0;p<i.k.length;p++){var b=i.k[p],y=p,I=document.createElement("div");I.className="dCategory ki-noHighlight ki-dd-category-"+y,I.setAttribute("ondragover","kInteractive.c.allowDrop(event)"),I.setAttribute("ondrop","kInteractive.c.drop(event)");var C=document.createElement("div");C.innerHTML=b.category.name,C.className="qTitle",I.appendChild(C);for(var E=0;E<b.category.answers.length;E++)k.push(b.category.answers[E].t);g.appendChild(I)}r.appendChild(g);var w=document.createElement("div");w.className="ki-dd-clearfix",r.appendChild(w);var N=document.createElement("div");N.setAttribute("ondragover","kInteractive.c.allowDrop(event)"),N.setAttribute("ondrop","kInteractive.c.drop(event)"),N.className="ki-dd-answers ki-noHighlight";var A=[];for(p=0;p<k.length;p++){y=p,f=k[p];var x=document.createElement("div");l="ki-dd-"+a+"-"+t+"-"+y;x.id=l,x.innerHTML="<span></span>",x.children[0].innerText=f,x.className="ki-draggable ans ki-noHighlight",x.draggable=!0,x.setAttribute("ondragstart","kInteractive.c.drag(event)"),A.push(x)}kInteractive.c.shuffleArray(A);for(p=0;p<A.length;p++)N.appendChild(A[p]);r.appendChild(N)}var q=document.createElement("p");if(q.className="separator",r.appendChild(q),document[item.id]&&document[item.id].preserve&&document[item.id].q&&document[item.id].q[t]){if(i.exp)if(!r.getElementsByClassName("explanation").length){var L=document.createElement("p");L.className="explanation",L.innerHTML=kInteractive.escapeHtml(i.exp),kInteractive.appendAfterDelay(r,L)}if(i.ref)if(!r.getElementsByClassName("reference").length){var T=document.createElement("a");T.className="reference",T.innerHTML=userDict.learnMode?userDict.learnMode:"Learn more",T.setAttribute("href",kInteractive.escapeHtml(i.ref)),T.setAttribute("target","_blank"),kInteractive.appendAfterDelay(r,T)}}return r},getQId:function(e){return Number(e.id.replace("ki-qs-",""))},createSubmitBtn:function(e,t){var n=this.getQId(t),a=document.createElement("input"),i="ki-"+n+"-btn";return a.type="submit",a.value=e.submit?e.submit:"Submit Answers",a.id=i,a.className="btn ki-btn questions-submit","undefined"==typeof isKotobee&&a.addEventListener("click",kInteractive.actionEvent),a},createClearBtn:function(e){var t=document.createElement("input");return t.type="submit",t.value=e.clear?e.clear:"Clear Answers",t.className="btn ki-btn ki-questions questions-clear","undefined"==typeof isKotobee&&t.addEventListener("click",kInteractive.actionEvent),t},createAddToNotebookBtn:function(e){var t=document.createElement("input");return t.type="submit",t.value=e.notebook?e.notebook:"Save to Notebook",t.className="btn ki-btn ki-questions questions-notebook","undefined"==typeof isKotobee&&t.addEventListener("click",kInteractive.actionEvent),t},createPreserveBtn:function(e,t){var n=this.getQId(t),a=document.createElement("div");a.style.marginTop="5px";var i=document.createElement("input");i.type="checkbox",i.name="preserveAnswers",i.className="ki-btn ki-questions questions-preserve",i.id="ki-"+n+"-preserveAnswersBtn",document[item.id]&&(i.checked=document[item.id].preserve),a.appendChild(i);var r=document.createElement("label");return r.htmlFor=i.id,r.innerHTML=" "+(e.preserve?e.preserve:"Preserve submitted answers"),r.className="ki-noHighlight",a.appendChild(r),"undefined"==typeof isKotobee&&i.addEventListener("change",kInteractive.actionEvent),a},createNextBtn:function(e){var t=document.createElement("input");return t.type="submit",t.value=e.next?e.next:"Next",t.className="btn ki-btn ki-questions questions-next","undefined"==typeof isKotobee&&t.addEventListener("click",kInteractive.actionEvent),t},createPrevBtn:function(e){var t=document.createElement("input");return t.type="submit",t.value=e.prev?e.prev:"Previous",t.className="btn ki-btn ki-questions questions-prev","undefined"==typeof isKotobee&&t.addEventListener("click",kInteractive.actionEvent),t},createSeparator:function(){document.createElement("p").className="separator"},createEmailForm:function(e){var o=document.createElement("div");return o.setAttribute("class","emailForm"),function(e,t,n){var a=document.createElement("div");a.className="address",a.innerHTML="<p><strong>"+e+"</strong><em>"+t+"</em></p>";var i=document.createElement("input");i.name=n,i.type="text",i.className="txtfield",a.appendChild(i);var r=document.createElement("p");r.className="separator",a.appendChild(r),o.appendChild(a)}(e.recipientEmail?e.recipientEmail:"Recipient email",e.separateEmails?e.separateEmails:"Separate multiple emails with commas","recipientEmail"),o},showNavBtns:function(e,t,n){var a;(a=(n=n||{}).isFrag?t.lastElementChild:t.getElementsByClassName("btnContainer")[0]).innerHTML="";var i=kInteractive.questions.f.createPrevBtn(n.userDict);a.appendChild(i),e<=0&&i.classList.add("disabled");var r=kInteractive.questions.f.createNextBtn(n.userDict);if(a.appendChild(r),e>=n.qsData.q.length-1&&r.classList.add("disabled"),e==n.qsData.q.length-1){var o=kInteractive.questions.f.createSubmitBtn(n.userDict,t);o.classList.add("shift"),a.appendChild(o)}},assess:function(e,t,n){for(var a={ddInteractionOb:[]},i=e.getElementsByClassName("ans"),r=0<i.length,o=0;o<i.length;o++)if(0<=i[o].getAttribute("id").indexOf("ki-tf-"))0==o&&t.a?a.correctResponses=t.choice1:1!=o||t.a||(a.correctResponses=t.choice2),i[o].checked?(a.learnerResponses=o?t.choice2:t.choice1,0!=o||t.a?1==o&&t.a&&(r=!1):r=!1):0==o&&t.a?r=!1:1!=o||t.a||(r=!1),n.options&&n.options.highlightCorrect&&(0==o&&t.a||1==o&&!t.a)&&kInteractive.c.addClass(i[o].parentNode,"correct");else if(0<=i[o].getAttribute("id").indexOf("ki-sa-")){var s=i[o].value.toLowerCase();s=s&&s.trim(),r=!0;for(var c="",d=0;d<t.k.length;d++){var l=t.k[d].t;if(!l){r=!1;break}c&&(c+="+"),c+=l=l.toLowerCase();for(var u=l.split(","),p=!1,m=0;m<u.length;m++)if(0<=s.indexOf(u[m].trim())){p=!0;break}if(!p){r=!1;break}}a.correctResponses=c,a.learnerResponses=s}else if(0<=i[o].getAttribute("id").indexOf("ki-dd-")){kInteractive.c.removeClass(i[o],"incorrect");var v=i[o].id.split("-")[4],h=t.answers[v].forCategory,f=e.getElementsByClassName("dCategory")[h],g={};if(g.correct=i[o].innerText+" -> "+f.children[0].innerText,kInteractive.c.hasClass(i[o].parentNode,"ki-dd-answers"))kInteractive.c.addClass(i[o],"incorrect"),r=!1,g.learner=i[o].innerText+" unassigned";else{var k=i[o].parentNode,b=k.children[0].innerText,y=kInteractive.getChildIndex(k);g.learner=i[o].innerText+" -> "+b,y!=h&&n.options&&n.options.highlightCorrect&&(r=!1,kInteractive.c.addClass(i[o],"incorrect"))}a.ddInteractionOb.push(g)}else t.c[o].a&&(a.correctResponses=t.c[o].t),i[o].checked&&(a.learnerResponses=t.c[o].t),i[o].checked&&!t.c[o].a?r=!1:!i[o].checked&&t.c[o].a&&(r=!1),n.options&&n.options.highlightCorrect&&t.c[o].a&&kInteractive.c.addClass(i[o].parentNode,"correct");return a.correct=r,a}}},kInteractive.threed={preRender:function(e,t){},postRender:function(e,t,n,a){var i=e.createDocumentFragment(),r=kInteractive.readData(t);if(r){t.innerHTML="";var o=t.getAttribute("style");if(r.inter.placeholderPath)o+="background-image:url('"+("undefined"==typeof isKotobee?r.inter.placeholderPath:ph.join(kInteractive.absoluteURL,r.inter.placeholderPath))+"');";t.setAttribute("style",o);var s=document.createElement("a");r.inter.includeMsg?(s.innerHTML=kInteractive.escapeHtml(r.inter.msg),s.className="msgBtn ki-btn"):s.className="invisibleBtn ki-btn",i.appendChild(s),"undefined"==typeof isKotobee&&s&&s.addEventListener("click",kInteractive.actionEvent),t.appendChild(i)}},action:function(f,e,t){var g=kInteractive.readData(f);if(g){"inPanel"==g.inter.target?kInteractive.c.addClass(f,"running"):f.innerHTML="";var k=document.createElement("div");if(k.className="loading",f.appendChild(k),"undefined"==typeof THREE){var n,a=document.getElementsByTagName("head")[0],i=a.getElementsByTagName("script");if("undefined"!=typeof isKotobee)n=bookPath+"EPUB/js/kotobeeInteractive3D.js";else for(var r=0;r<i.length;r++)if(0<=i[r].src.indexOf("kotobeeinteractive.js")){n=i[r].src.replace("kotobeeinteractive.js","kotobeeinteractive3D.js");break}if(!n)return;var o=document.createElement("script");o.type="text/javascript",o.src=n,o.onload=s,o.onreadystatechange=function(){"complete"==this.readyState&&s()},a.appendChild(o)}else s()}function s(){var h,e=f;if("inPanel"==g.inter.target){var t={class:"threed",cb:function(e){var t=document.createElement("div");t.className="container",e.appendChild(t),n(t)},closed:function(){kInteractive.c.removeClass(f,"running")}};kInteractive.openFrame(t)}else n(e);function n(t){var n;setTimeout(function(){if(kInteractive.scorm){var e={};e.id=kInteractive.getScormId("_3D",g.name?g.name:"Model"),e.description="Opened 3D model: "+(g.name?g.name:"No name"),e.learnerResponses="Viewed",e.type="other",e.timestamp=new Date,kInteractive.scorm.setInteractions([e])}kInteractive.events&&kInteractive.events.add({action:"3dModelViewed",param:g.name?g.name:"No name",elem:f,data:g})},800),h&&cancelAnimationFrame(h),n=function(){try{var e=document.createElement("canvas");return!(!window.WebGLRenderingContext||!e.getContext("webgl")&&!e.getContext("experimental-webgl"))}catch(e){return!1}}()?new THREE.WebGLRenderer({precision:"highp"}):new THREE.CanvasRenderer;var e=t.offsetWidth,a=t.offsetHeight,i=new THREE.PerspectiveCamera(g.camera.viewAngle,e/a,g.camera.near,g.camera.far),c=new THREE.Scene;null!=g.scene.bgColor&&n.setClearColor(g.scene.bgColor,1),c.add(i),i.position.x=g.camera.x,i.position.y=g.camera.y,i.position.z=g.camera.z,n.setSize(e,a),g.scene.floor&&(floor=new THREE.Mesh(new THREE.PlaneGeometry(500,500,1,1),new THREE.MeshPhongMaterial({color:g.scene.floorColor?g.scene.floorColor:10066329})),floor.applyMatrix((new THREE.Matrix4).makeRotationX(-Math.PI/2)),floor.position.y=-80,floor.receiveShadow=!0,c.add(floor));var d=new THREE.LoadingManager;d.onProgress=function(e,t,n){},function r(o){if(!(o>=g.objects.length)){var s=g.objects[o],e="undefined"==typeof isKotobee?s.path:ph.join(kInteractive.absoluteURL,s.path);new THREE.OBJLoader(d).load(e,function(i){k&&k.parentNode&&k.parentNode.removeChild(k),n.domElement.parentNode||t.appendChild(n.domElement),i.position.set(s.x,s.y,s.z),i.traverse(function(n){if(n instanceof THREE.Mesh){var a=n==i.children[i.children.length-1];if(s.textPath){var e=new THREE.ImageLoader(d),t="undefined"==typeof isKotobee?s.textPath:ph.join(kInteractive.absoluteURL,s.textPath);e.load(t,function(e){var t=new THREE.Texture;t.image=e,t.needsUpdate=!0,n.material.map=t,a&&c.add(i),r(++o)},function(){},function(e){})}else a&&c.add(i),r(++o)}})},function(e){e.lengthComputable&&(e.loaded,e.total)},function(e){})}}(0),new THREE.OrbitControls(i,n.domElement).target=new THREE.Vector3(0,0,0);for(var r=0;r<g.lights.length;r++)if("pointLight"==g.lights[r].type){var o=new THREE.PointLight(g.lights[r].color);o.position.set(g.lights[r].x,g.lights[r].y,g.lights[r].z),c.add(o)}else if("directionalLight"==g.lights[r].type){var s=new THREE.DirectionalLight(g.lights[r].color,g.lights[r].intensity);s.position.set(g.lights[r].x,g.lights[r].y,g.lights[r].z),c.add(s)}else if("hemisphereLight"==g.lights[r].type){var l=new THREE.HemisphereLight(g.lights[r].sky,g.lights[r].ground,g.lights[r].intensity);l.position.set(g.lights[r].x,g.lights[r].y,g.lights[r].z),c.add(l)}else if("spotLight"==g.lights[r].type){var u=new THREE.SpotLight(g.lights[r].color,g.lights[r].intensity,g.lights[r].distance,g.lights[r].angle,g.lights[r].exponent,g.lights[r].decay);u.position.set(g.lights[r].x,g.lights[r].y,g.lights[r].z),c.add(u)}else if("ambientLight"==g.lights[r].type){var p=new THREE.AmbientLight(g.lights[r].color);c.add(p)}else if("areaLight"==g.lights[r].type){var m=new THREE.AreaLight(g.lights[r].color,g.lights[r].intensity);c.add(m)}var v=new THREE.Clock;!function e(){try{n.render(c,i)}catch(e){return}v.getDelta();h=requestAnimFrame(e)}()}}}},kInteractive.video={preRender:function(e,t){},postRender:function(e,t,n){var a=e.createDocumentFragment(),i=kInteractive.readData(t);if(i){var r="";if(i.splash&&(r="undefined"==typeof isKotobee?i.splash:ph.join(kInteractive.absoluteURL,i.splash)),r){t.style.backgroundImage=null;var o=t.style.cssText;t.setAttribute("style","background-image:url('"+r+"');"+o)}t.setAttribute("id","ki-video-"+n),t.innerHTML="";var s=document.createElement("div");s.setAttribute("id","ki-video-"+n+"-container"),s.className="container";var c=document.createElement("div");i.style&&kInteractive.c.addClass(c,i.style);var d=document.createElement("a");d.className="playBtn ki-btn",d.appendChild(document.createElement("span")),"undefined"==typeof isKotobee&&d.addEventListener("click",kInteractive.actionEvent),a.appendChild(d),a.appendChild(s),c.appendChild(a),t.appendChild(c),i.autoplay&&kInteractive.action(t)}},action:function(r){var o=kInteractive.readData(r);if(o){if(o.popup&&"kInteractiveFrame"!=r.parentNode.id){var e={pos:"side",aspectRatio:"16:9",cb:function(e){var t=document.createElement("div");t.innerHTML=r.outerHTML;var n=t.children[0];n.style.height="100%",n.style.margin="0",n.style.position="absolute",e.appendChild(n);var a=r.id.split("ki-video-")[1];kInteractive.postRender(document,n,a),setTimeout(function(){kInteractive.action(n)},100)}};return kInteractive.openFrame(e)}var t=r.getAttribute("id")+"-container",s=r.getElementsByClassName("playBtn")[0];if(!(0<=s.className.indexOf("loading"))){if(kInteractive.stopCurrentMedia(),s.className="playBtn ki-btn loading",o.autoplay&&(s.className="playBtn ki-btn hide"),kInteractive.scorm){var n={};n.id=kInteractive.getScormId(r.getAttribute("id"),o.src),n.description="Played video: "+o.src,n.type="other",n.learnerResponses="Played",n.objective=o.options?o.options.objective:null,n.timestamp=new Date,kInteractive.scorm.setInteractions([n])}if(kInteractive.events&&kInteractive.events.add({action:"videoPlayed",param:o.src,elem:r,data:o}),"file"==o.type){u("undefined"==typeof isKotobee?o.video:ph.join(kInteractive.absoluteURL,o.video))}else{var a,i=new URL(o.src);if(i.origin.includes("youtube.com")||i.origin.includes("youtu.be")){if(!(a=i.origin.includes("youtube.com")?i.searchParams.get("v"):i.pathname.split("/")[1]))return;if(window&&window.iBooks)return setTimeout(function(){s.className="playBtn ki-btn"},1500),void(window.location.href=o.src);var c={videoId:a,playerVars:{autoplay:1,rel:"0"},events:{onReady:function(){},onStateChange:function(e){e.data==YT.PlayerState.PLAYING&&kInteractive.tinCan({verb:"played",activity:"Video: "+o.src})}}};if(kInteractive.youTubeStatus)if("loading"==kInteractive.youTubeStatus){if(kInteractive.vQueue)return;kInteractive.vQueue=function(){s.className="playBtn ki-btn hide",new YT.Player(t,c)}}else"ready"==kInteractive.youTubeStatus&&(s.className="playBtn ki-btn hide",new YT.Player(t,c));else{window.onYouTubePlayerAPIReady=function(){kInteractive.youTubeStatus="ready",kInteractive.vQueue(),kInteractive.vQueue=null};var d=document.createElement("script");d.src="https://www.youtube.com/player_api";var l=document.getElementsByTagName("script")[0];l.parentNode.insertBefore(d,l),kInteractive.youTubeStatus="loading",kInteractive.vQueue=function(){s.className="playBtn ki-btn hide",new YT.Player(t,c)}}}else u(o.src)}kInteractive.currentVideo=r,kInteractive.c.addClass(kInteractive.currentVideo,"playing")}}function u(e){var t,n=document.createElement("video");n.setAttribute("width","100%"),n.setAttribute("height","100%"),n.setAttribute("src",e),n.setAttribute("autoplay","true"),n.setAttribute("data-tap-disabled","false"),0!=e.indexOf("http://")&&0!=e.indexOf("https://")||(t=!0),t&&n.setAttribute("crossorigin","anonymous");var a=!1;try{a=-1<navigator.userAgent.toLowerCase().indexOf("android")}catch(e){}a||n.setAttribute("type","video/mp4"),n.setAttribute("webkit-playsinline","true"),n.setAttribute("controls","true"),n.className="ki-noHighlight",o.hideDownloadBtn&&(n.className+=" hideDownloadBtn"),n.innerHTML="Your browser doesn't support HTML5 video.",t&&(n.crossOrigin="anonymous"),n.oncanplay=function(){kInteractive.currentVideo==r&&(s.className="playBtn ki-btn hide",kInteractive.tinCan({verb:"played",activity:"Video: "+e}))},n.addEventListener("error",function(e){kInteractive.stopCurrentMedia()}),n.addEventListener("webkitfullscreenchange",function(e){var t=null!==document.webkitFullscreenElement;kInteractive.videoIsFullscreen=t});var i=r.getElementsByClassName("container")[0];i.setAttribute("data-tap-disabled","true"),i.appendChild(n)}},resize:function(e){var t=kInteractive.readData(e);t&&(kInteractive.checkResponsiveFloat(t,e),t.maintainRatio&&"px"==t.widthUnit&&t.height&&t.width&&(e.style.height=e.offsetWidth*(t.height/t.width)+"px"))}},kInteractive.widget={preRender:function(e,t){},postRender:function(e,t,n,a){a=a||{};var i=e.createDocumentFragment(),r=kInteractive.readData(t);if(r){var o=r.name,s=(r.src,r.width),c=r.height;if("page"==r.mode){if(t.children.length)return;var d=document.createElement("div");d.className="cover",i.appendChild(d),r.interaction&&(d.style.pointerEvents="none");var l=document.createElement("div");l.className="iframeContainer";var u=document.createElement("iframe");if(u.setAttribute("nwdisable","true"),u.setAttribute("nwfaketop","true"),u.setAttribute("sandbox","allow-same-origin allow-scripts allow-forms allow-modals"),u.setAttribute("width",t.style.width?t.style.width:s+r.widthUnit),u.setAttribute("height",t.style.height?t.style.height:c+"px"),u.src=kInteractive.getWidgetUrl(r,a),"undefined"!=typeof kotobee&&-1!==u.src.indexOf(".amazonaws.com")){var p=document.createElement("a");p.href=u.src,u.addEventListener("load",function(e){e.target.contentWindow.postMessage({user:{name:kotobee.user.name?kotobee.user.name:"",email:kotobee.user.email?kotobee.user.email:"",loggedIn:kotobee.user.loggedIn},book:kotobee.book.meta.dc.identifier,chapter:kotobee.currentChapter.url.split("EPUB/xhtml/")[1]},p.protocol+"//"+p.hostname)})}l.appendChild(u),i.appendChild(l);var m=t.style.width,v=t.style.height;0<=m.indexOf("px")&&(r.widthUnit="px"),0<=m.indexOf("%")&&(r.widthUnit="%");try{r.widthUnit?r.width=Number(m.split(r.widthUnit)[0]):r.width=Number(m)}catch(e){r.width=Number(m)}try{r.height=Number(v.split("px")[0])}catch(e){r.height=Number(v)}kInteractive.writeData(t,r)}else{if(!t.children.length&&!t.innerHTML.trim()){var h=document.createElement("img");h.src=kInteractive.getWidgetHome(r,a)+"/"+o+"/Icon.png?c="+Math.round(9999*Math.random()),h.className="wdgtIcon",i.appendChild(h)}"undefined"==typeof isKotobee&&t.addEventListener("click",kInteractive.actionEvent)}t.appendChild(i)}},action:function(t){var n=kInteractive.readData(t);if(n){var a=kInteractive.getWidgetUrl(n),i=document.createElement("iframe");i.setAttribute("nwdisable","true"),i.setAttribute("nwfaketop","true"),i.setAttribute("sandbox","allow-same-origin allow-scripts allow-forms allow-modals"),n.cb=function(e){i.src=a,e.appendChild(i)},n.cb1="yes",n.closed=function(){},n.responsive&&(n.width=n.height=null),kInteractive.openFrame(n),kInteractive.tinCan({verb:"opened",activity:"Widget: "+n.name}),setTimeout(function(){if(kInteractive.scorm){var e={};e.id=kInteractive.getScormId("widget",n.name),e.description="Opened popup widget: "+n.name,e.learnerResponses="Opened",e.type="other",e.timestamp=new Date,kInteractive.scorm.setInteractions([e])}kInteractive.events&&kInteractive.events.add({action:"popupWidgetOpened",param:n.name,elem:t,data:n})},800)}},resize:function(e){var t=kInteractive.readData(e);if(t&&"page"==t.mode&&"px"==t.widthUnit){var n=t.width,a=t.height,i=e.parentNode;if(i)if(n>i.offsetWidth){var r=i.offsetWidth/n,o=e.children.length-1;e.children[o].style.transform=e.children[o].style.webkitTransform=e.children[o].style.mozTransform="scale("+r+")",e.children[o].style.transformOrigin=e.children[o].style.webkitTransformOrigin=e.children[o].style.mozTransformOrigin="0 0",e.style.maxWidth=e.style.width,e.style.height=Math.round(a*r)+"px"}else{for(o=0;o<e.children.length;o++)e.children[o].style.transform=e.children[o].style.webkitTransform=e.children[o].style.mozTransform=e.children[o].style.transformOrigin=e.children[o].style.webkitTransformOrigin=e.children[o].style.mozTransformOrigin=null;e.style.maxWidth=null,e.style.height=a+"px"}}}};