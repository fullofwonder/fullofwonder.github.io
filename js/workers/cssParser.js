var id,desktop,self=this;function parse(e){var r=self,t=(e=e||{},e.data),n=e.rootPath,i=e.cssOb;t=(t=(t=(t=(t=(t=r.applyRoot(n,t)).replace(/\/\*[\s\S]*?\*\//g,"")).replace(/<!--/g,"")).replace(/-->/g,"")).replace(/@charset.*?;/g,"")).replace(/@namespace.*?;/g,"");var s="spreadL > section";e.id&&(s=e.id);var a=(i.parentClass?i.parentClass:"#epubContainer.stylesEnabled")+" #"+s,l=cssToJson(t),p="";try{for(var o=0;o<l.length;o++){var h=g(l[o].keys);if(p+=h.joined,p+="{",l[o].children&&l[o].children.length)for(var d=0;d<l[o].children.length;d++){var c,f=g(l[o].children[d].keys);if(p+=f.joined,p+="{"+l[o].children[d].properties+"}",f.hasBody)(c=u(l[o].properties))&&(p+="#epubContainer{"+c+"}")}if(l[o].properties&&(p+=l[o].properties),p+="}",h.hasBody)(c=u(l[o].properties))&&(p+="#epubContainer{"+c+"}")}}catch(e){}function u(e){if(e){for(var r=e.split(";"),t="",n=0;n<r.length;n++)r[n]&&-1!=r[n].trim().indexOf("background")&&(t=r[n].trim().replace(/url\(.*?\)/g,"")+";");return t}}function g(e){for(var r={},t=0;t<e.length;t++)if(e[t]){var n=e[t].trim();0!=n.indexOf("body")?0!=n.indexOf("html")?0!=n.indexOf("@media")&&0!=n.indexOf("@")&&isNaN(n[0])&&"from"!=n&&"to"!=n&&(e[t]=a+" "+n):e[t]=n.replace("html",a):(e[t]=n.replace("body",a),0==e[t].indexOf("html")&&(e[t]=e[t].replace("html",a)),r.hasBody=!0)}return r.joined=e.join(","),r}t=minimizeData(t=p),self.postMessage({data:t,id:id})}function minimizeData(e){var r=e;return r=(r=(r=(r=(r=r.replace(/\/\*(?:(?!\*\/)[\s\S])*\*\/|[\r\n\t]+/g,"")).replace(/ {2,}/g," ")).replace(/ ([{:}]) /g,"$1")).replace(/([;,]) /g,"$1")).replace(/ !/g,"!")}function cssToJson(e){e=e.replace(/\r?\n|\r/g," ");var r,t=[],n="key",i=[0],s=t,a=[s];function l(e){return e=e||1,i[i.length-e]}for(var p=0;p<e.length;p++)r=r||{},"}"==e[p]?("properties"==n&&(r.properties=e.substring(l(),p).trim(),r.keys&&r.keys.length&&(r.keys[r.keys.length-1]=r.keys[r.keys.length-1].trim()),s.push(r)),"key"==n&&1<a.length&&(a.pop(),s=a[a.length-1]),r=null,n="key",i.push(p+1)):"{"==e[p]?("properties"==n&&(r.children||(r.children=[]),r.keys&&r.keys.length&&(r.keys[r.keys.length-1]=r.keys[r.keys.length-1].trim()),t.push(r),s=r.children,a.push(s),(r={keys:[]}).keys.push(e.substring(l(),p).trim())),i.push(p+1),n="properties"):"key"==n&&(r.keys||(r.keys=[""]),","==e[p]?r.keys.push(""):r.keys[r.keys.length-1]+=e[p]);return t}function applyRoot(n,e){return e.replace(/url\((.*?)\)/g,function(e,r){var t="";return 0==r.indexOf('"')?(r=r.substr(1,r.length-2),t='"'):0==r.indexOf("'")&&(r=r.substr(1,r.length-2),t="'"),-1!=r.indexOf("http://")?e:-1!=r.indexOf("https://")?e:0==r.indexOf("data:")?e:"url("+t+(r=ph.join(n,r))+t+")"})}function isAbsoluteURLPath(e){return 0==e.trim().indexOf("http://")||(0==e.trim().indexOf("https://")||(0==e.trim().indexOf("//")||(0==e.trim().indexOf("data:")||void 0)))}self.addEventListener("message",function(e){var r=e.data.func,t=e.data.params;id=e.data.id,desktop=e.data.desktop,self[r].apply(self,t)},!1);var ph={join:function(){for(var e=new Array,r=0;r<arguments.length;r++){var t=ph.normalizedArray(arguments[r]);r<arguments.length-1&&!isAbsoluteURLPath(t[t.length-1])&&0<=t[t.length-1].indexOf(".")&&t.splice(t.length-1,1),e=e.concat(t)}var n=ph.normalize(e.join("/"));return"/"==arguments[0].substr(0,1)&&(n=desktop?"file:////"+n:"/"+n),n},normalize:function(e){var r=ph.normalizedArray(e).join("/");return arguments.length&&"/"==e.substr(0,1)&&(r="file:///"+r),r},normalizedArray:function(e){for(var r=(e=e.replace(/\\/g,"/")).split("/"),t=r.length;t--;)r[t]?".."==r[t]&&0<t&&".."!=r[t-1]&&(r.splice(t,1),r.splice(t-1,1)):r.splice(t,1);return r[0].match(/http[s]?:$/g)&&(r[0]+="//"+r[1],r.splice(1,1)),"file:"==r[0]&&(r[0]+="///"+r[1],r.splice(1,1)),r}},log=console.log;